<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flipbook Katalog Cipanas</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap');

body {
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: 
    radial-gradient(circle at top left, rgba(200, 220, 200, 0.2) 0%, transparent 20%),
    radial-gradient(circle at bottom right, rgba(200, 220, 200, 0.2) 0%, transparent 20%),
    url('Background_Website.jpg') no-repeat center center fixed;
  background-size: cover;
  font-family: 'Lora', serif;
  overflow: hidden;
  position: relative;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.4);
  backdrop-filter: blur(4px);
  z-index: 0;
}

.flipbook-container {
  position: relative;
  width: 50vw;
  height: 95vh;
  max-width: 950px;
  max-height: 1340px;
  border-radius: 10px;
  overflow: hidden;
  background-image: url('Frame1.jpg');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center center;
  background-color: #E5F5E5;
  box-shadow: 0 8px 18px rgba(0,0,0,0.4);
  perspective: 2500px;
  transform-style: preserve-3d;
  z-index: 1;
}

.page {
  width: 100%;
  height: 100%;
  position: absolute;
  backface-visibility: hidden;
  transform-origin: left center;
  transition: transform 0.8s cubic-bezier(0.4,0,0.2,1);
  box-shadow: 0 0 15px rgba(0,0,0,0.15);
  will-change: transform;
}

.page:not(.active) { z-index: 1; }
.page.active { transform: rotateY(0deg); z-index: 2; }

.page img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.page.flip-next { z-index: 3; animation: flipNext 0.8s forwards; }
.page.flip-prev { z-index: 3; animation: flipPrev 0.8s forwards; }

@keyframes flipNext {
  0% { transform: rotateY(0deg); opacity: 1; }
  100% { transform: rotateY(-180deg); opacity: 1; }
}

@keyframes flipPrev {
  0% { transform: rotateY(-180deg); opacity: 1; }
  100% { transform: rotateY(0deg); opacity: 1; }
}

.nav-button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(198,166,100,0.95);
  color: #fff;
  border: none;
  padding: 14px 18px;
  font-size: 1.3em;
  cursor: pointer;
  border-radius: 50%;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  transition: background 0.3s ease, transform 0.2s;
  z-index: 5;
}

.nav-button:hover {
  background: #A5844C;
  transform: translateY(-50%) scale(1.1);
}

.prev { left: calc(50% - 48vw); } 
.next { right: calc(50% - 48vw); }

.page-number {
  position: absolute;
  bottom: 6px;
  right: 6px;
  background: rgba(255, 255, 255, 0.7);
  padding: 2px 6px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
}

.search-bar {
  position: fixed;
  top: 15px;
  right: 20px;
  background: rgba(255,255,255,0.9);
  padding: 6px 10px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  display: flex;
  gap: 6px;
  align-items: center;
  z-index: 999;
}

.search-bar input {
  width: 70px;
  padding: 5px 7px;
  font-size: 0.9em;
  border: 1px solid #aaa;
  border-radius: 4px;
  outline: none;
  text-align: center;
}

.search-bar button {
  padding: 5px 10px;
  background: #C6A664;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.85em;
  transition: background 0.3s;
}

.search-bar button:hover { background: #A5844C; }

.copyright {
  position: fixed;
  bottom: 8px;
  right: 10px;
  font-size: 0.8em;
  color: #333;
  background: rgba(255,255,255,0.7);
  padding: 4px 8px;
  border-radius: 5px;
  z-index: 10;
}

@media (max-width: 600px) {
  .flipbook-container { width: 95vw; height: 88vh; }
  .prev { left: 4px; }
  .next { right: 4px; }
  .nav-button { padding: 12px 14px; font-size: 1.1em; }
  .page-number { bottom: 22px; right: 50%; transform: translateX(50%); font-size: 12px; padding: 4px 10px; }
  .copyright { bottom: 50px; right: 35px; padding: 5px 8px; font-size: 0.75em; }
  .search-bar { top: 70px; right: 20px; }
}
</style>
</head>
<body>

<div class="search-bar">
  <input type="number" id="pageInput" placeholder="Hal..." min="1">
  <button onclick="goToPage()">Cari</button>
</div>

<button class="nav-button prev" onclick="prevPage()">❮</button>
<button class="nav-button next" onclick="nextPage()">❯</button>

<div class="flipbook-container" id="flipbook-container">
  <div class="page-number" id="pageNumber">Hal 1 / 123</div>
</div>

<div class="copyright">
  © 2025 E-Katalog Koleksi Istana Kepresidenan Cipanas
</div>

<script>
const container = document.getElementById('flipbook-container');
const totalPages = 123;
let currentPage = 1;
let isAnimating = false;

const pageNumber = document.getElementById('pageNumber');
const pageInput = document.getElementById('pageInput');

function updatePageNumber() {
  pageNumber.textContent = `Hal ${currentPage} / ${totalPages}`;
  pageInput.value = currentPage;
}

function preloadImage(index) {
  if(index > 0 && index <= totalPages){
    const img = new Image();
    img.src = `iscip${index}.jpg`;
  }
}

// preload ±3 halaman untuk lancar
function preloadAround(index){
  for(let i=-3; i<=3; i++){
    if(i!==0) preloadImage(index+i);
  }
}

// buat halaman awal
let currentImg = document.createElement('div');
currentImg.className = 'page active';
currentImg.style.willChange = 'transform';
currentImg.style.transform = 'translateZ(0)';
currentImg.innerHTML = `<img src="iscip${currentPage}.jpg" alt="Halaman ${currentPage}">`;
container.appendChild(currentImg);
preloadAround(currentPage);

function showPage(index){
  if(index < 1 || index > totalPages || index === currentPage || isAnimating) return;
  isAnimating = true;

  // hapus shadow sementara agar GPU lebih ringan
  container.style.boxShadow = 'none';

  const direction = index > currentPage ? 'next' : 'prev';
  const newPage = document.createElement('div');
  newPage.className = 'page';
  newPage.style.willChange = 'transform';
  newPage.style.transform = 'translateZ(0)';
  newPage.innerHTML = `<img src="iscip${index}.jpg" alt="Halaman ${index}">`;
  container.appendChild(newPage);

  requestAnimationFrame(() => {
    if(direction==='next') currentImg.classList.add('flip-next');
    else newPage.classList.add('flip-prev');
  });

  const fallbackTimeout = setTimeout(finishAnimation, 850);

  function finishAnimation(){
    clearTimeout(fallbackTimeout);
    currentImg.remove();
    newPage.classList.remove('flip-next','flip-prev');
    newPage.classList.add('active');
    currentImg = newPage;
    currentPage = index;
    updatePageNumber();
    isAnimating = false;
    preloadAround(currentPage);

    // kembalikan shadow
    container.style.boxShadow = '0 8px 18px rgba(0,0,0,0.4)';
  }

  currentImg.addEventListener('animationend', finishAnimation, {once:true});
}

function nextPage(){ if(currentPage<totalPages) showPage(currentPage+1); }
function prevPage(){ if(currentPage>1) showPage(currentPage-1); }

function goToPage(){
  const page = parseInt(pageInput.value);
  if(!isNaN(page) && page>=1 && page<=totalPages) showPage(page);
  else { alert(`Masukkan nomor antara 1 dan ${totalPages}`); pageInput.value = currentPage; }
}

document.addEventListener('keydown', (e)=>{
  if(document.activeElement !== pageInput && !isAnimating){
    if(e.key==='ArrowRight') nextPage();
    else if(e.key==='ArrowLeft') prevPage();
  } else if(e.key==='Enter') goToPage();
});

// SWIPE MOBILE
let touchStartX = 0, touchEndX = 0;
container.addEventListener('touchstart', (e)=>{ touchStartX = e.changedTouches[0].screenX; });
container.addEventListener('touchend', (e)=>{
  touchEndX = e.changedTouches[0].screenX;
  const diff = touchEndX - touchStartX;
  if(Math.abs(diff) > 50){
    if(diff < 0) nextPage();
    else prevPage();
  }
});

updatePageNumber();
</script>
</body>
</html>
